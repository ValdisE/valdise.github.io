<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>pipe_zrender</title>
    <style>
        *{margin: 0; padding: 0}
        html, body, #main{width: 100%; height: 100%}
        body{overflow-y: hidden; background-color: #282C34}
    </style>
</head>
<body>
<div id="main"></div>

<script src="../js/jquery-3.3.1.min.js"></script>
<script src="https://cdn.bootcss.com/zrender/4.0.5/zrender.js"></script>
<script src="./script/data.js"></script>
<script src="./script/utils.js"></script>
<script>
    // ZRender初始化
    let zr = zrender.init(document.getElementById('main'));

    // 标题文字
    let title = new zrender.Rect({
        shape: {
            x: 0, y: 0,
            width: window.innerWidth, height: 140,
        },
        style: {
            fill: 'transparent',
            text: '管网计算与预警系统',
            textFill: '#7bfff8',
            font: '36px LEXUS 简粗黑 U',
            fontWeight: 'lighter',
            textAlign: 'center'
        },
    });
    zr.add(title);


    // 提示框
    let pipeInfoBlock =　new pipeInfoToolTip();

    // 绘制方块
    let blocks_outer = new Array(blocks_data.length);
    let blocks_inner = new Array(blocks_data.length);
    for (let i = 0; i < draw_blocks_data.length; i++) {
        blocks_outer[i] = new zrender.Rect({
            shape: {
                x: draw_blocks_data[i].x,
                y: draw_blocks_data[i].y,
                width: draw_blocks_data[i].w,
                height: draw_blocks_data[i].h,
            },
            style: {fill: '#3a66b6'},
            zlevel: 1,
        });
        zr.add(blocks_outer[i]);
        blocks_outer[i].on('mousemove', function (e) {
            //infoBlock.attr({shape: {x: e.offsetX+5, y: e.offsetY+5}, style: {opacity: 0.7}});
        }).on('mouseout', function () {
            //infoBlock.attr({style: {opacity: 0}});
        });

        blocks_inner[i] = new zrender.Rect({
            shape: {
                x: draw_blocks_data[i].x + 4,
                y: draw_blocks_data[i].y + 4,
                width: draw_blocks_data[i].w - 8,
                height: draw_blocks_data[i].h - 8,
            },
            style: {
                //lineWidth: 4,
                //stroke: '#3a66b6',
                fill: '#282c34',
                text: draw_blocks_data[i].name,
                textFill: '#7bfff8',
                font: draw_blocks_data[i].font,
                textLineHeight: 200,
                textRect: {
                    x: draw_blocks_data[i].x,
                    y: draw_blocks_data[i].y,
                    width: draw_blocks_data[i].w/1,
                    height: draw_blocks_data[i].h,
                }
            },
            zlevel: 1,
        });
        zr.add(blocks_inner[i]);
    }

    // 绘制管道
    let blocks_pipe = new Array(blocks_data.length);
    for (let i = 0; i < draw_pipes_segment_data.length; i++) {
        blocks_pipe[i] = new zrender.Rect({
            shape: {
                x: draw_pipes_segment_data[i].x,
                y: draw_pipes_segment_data[i].y,
                width: draw_pipes_segment_data[i].w,
                height: draw_pipes_segment_data[i].h,
            },
            style: {
                fill: pipes_segment_data[i].color
            },
            zlevel: 0,
        });
        zr.add(blocks_pipe[i]);

        // 鼠标交互
        blocks_pipe[i].on('mousemove', function (e) {
            blocks_pipe[i].attr({            // 发光
                style: {
                    shadowBlur: 20,
                    shadowColor: pipes_segment_data[i].color
                }
            });
            pipeInfoBlock.display(e.offsetX, e.offsetY, '26 km/h', '89 °C', '8000 N');
        }).on('mouseout', function () {
            blocks_pipe[i].attr({
                style: {
                    shadowBlur: 0,
                }
            });
            pipeInfoBlock.vanish();
        });

        addPipeFLow(draw_pipes_segment_data[i], 6, 2);      // 添加流动
    }


</script>
</body>
</html>